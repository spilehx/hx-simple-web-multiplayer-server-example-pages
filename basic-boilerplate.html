<!DOCTYPE html>
<html>

<head>
	<script>

		// load the comms code provided by the server
		// This page is loaded as a frame and is passed the parent origin as a url param, 
		// so we can use that to get "https://whereYourServerIs.com/framecode.js"
		window.onload = function () {
			const s = document.createElement('script');
			s.src = new URLSearchParams(location.search).get("parentOrigin") + "/framecode.js";
			s.onload = () => {
				frameMessaging.init(); // Start comms!

				frameMessaging.onHostMessage = onHostMessage; // set a function to get the messages
			};
			document.head.appendChild(s);
		};

		// Incoming messages!
		function onHostMessage(msg) {
			var type = msg.type;
			var message = msg.data;
			switch (type) {
				case "SOCKET_OPEN":
					console.log("SOCKET_OPEN");
					break;

				case "SOCKET_CLOSE":
					console.log("SOCKET_CLOSE");
					break;

				case "SOCKET_ERROR":
					console.log("SOCKET_ERROR");
					break;

				case "SOCKET_REGISTER":
					console.log("SOCKET_REGISTER");
					break;

				case "SOCKET_KEEPALIVE":
					console.log("SOCKET_KEEPALIVE");
					break;

				case "SOCKET_MESSAGE":
					console.log("SOCKET_MESSAGE");
					onSocketMessage(message);
					break;
			}
		}

		function onSocketMessage(message) {
			document.getElementById("nusers").innerHTML = message.data.connectedUsers;
		}


		/* Create functions like these to send data */

		function sendGlobalMessage() {
			// GlobalMessages are passed on to ALL users

			// You can send ANY data structure you like!
			var data = {
				foo: "bar",
				thing: 1
			};
			frameMessaging.sendGlobalMessage(data);
		}

		function sendDirectMessage() {
			// DirectMessage are passed only to a specific user
			// a user list is sent to you in your GlobalMessages, find UserId there
			var userID = "1234567";
			// You can send ANY data structure you like!
			var data = {
				foo: "bar",
				thing: 1
			};
			frameMessaging.sendDirectMessage(data, userID);
		}

	</script>
</head>

<body>
	<p id="nusers"></p>
</body>

</html>