<!DOCTYPE html>
<html>

<head>
	<script>

		// load the comms code provided by the server
		// This page is loaded as a frame and is passed the parent origin as a url param, 
		// so we can use that to get "https://whereYourServerIs.com/framecode.js"
		window.onload = function () {
			const s = document.createElement('script');
			s.src = new URLSearchParams(location.search).get("parentOrigin") + "/framecode.js";
			s.onload = () => {
				frameMessaging.init(); // Start comms!

				frameMessaging.onHostMessage = onHostMessage; // set a function to get the messages
			};
			document.head.appendChild(s);
		};

		// Incoming messages!
		function onHostMessage(msg) {
			var type = msg.type;
			var message = msg.data;
			switch (type) {
				case "SOCKET_OPEN":
					console.log("SOCKET_OPEN");
					break;

				case "SOCKET_CLOSE":
					console.log("SOCKET_CLOSE");
					break;

				case "SOCKET_ERROR":
					console.log("SOCKET_ERROR");
					break;

				case "SOCKET_REGISTER":
					console.log("SOCKET_REGISTER");
					break;

				case "SOCKET_KEEPALIVE":
					console.log("SOCKET_KEEPALIVE");
					break;

				case "SOCKET_MESSAGE":
					console.log("SOCKET_MESSAGE");
					onSocketMessage(message);
					break;
			}
		}

		function onSocketMessage(message) {
			document.getElementById("nusers").innerHTML = message.data.connectedUsers;

		}

	</script>
</head>

<body>
	<p id="nusers"></p>
</body>

</html>